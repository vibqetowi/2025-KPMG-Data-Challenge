# test_evm_metrics.py
import os
import sys
import pandas as pd

# ðŸ‘‡ Adds 'scripts/' to sys.path so imports work from there
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '../../')))

from evm_metrics import compute_evm_metrics
from advanced_data_analysis.fetcher import DataFetcher


# âœ… Set up the CSV fetcher
fetcher = DataFetcher(source="csv", csv_base_path="C:\\Users\\elrom\\Documents\\2025-KPMG-Data-Challenge\\csv-dump")

# âœ… Load timesheet data
df_time = fetcher.fetch_data("timesheets")["timesheets"]

# âœ… Compute EV, PV, SPI
summary = compute_evm_metrics(df_time)

# âœ… Display results
print(summary)

# âœ… Save summary to CSV
output_path = "C:\\Users\\elrom\\Documents\\2025-KPMG-Data-Challenge\\csv-dump\\evm_summary.csv"
summary.to_csv(output_path, index=False)
print(f"âœ… EVM summary saved to {output_path}")
